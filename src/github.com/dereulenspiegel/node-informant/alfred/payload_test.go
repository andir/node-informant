package alfred

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestCreatingRequest(t *testing.T) {
	assert := assert.New(t)
	request := NewRequestTLV(158)
	assert.NotNil(request)
	request.Marshall()
}

func TestTransactionIdIsRandom(t *testing.T) {
	assert := assert.New(t)

	request1 := NewRequest(158)
	request2 := NewRequest(158)
	assert.NotEqual(request1.TransactionId, request2.TransactionId)
}

var alfredDataBytes = []byte{207, 134, 0, 0, 196, 110, 31, 45,
	89, 54, 158, 0, 1, 146, 31, 139, 8, 0, 52, 83, 4, 86,
	2, 3, 109, 145, 65, 107, 227, 48, 16, 133, 255, 74,
	209, 217, 246, 90, 106, 237, 52, 58, 151, 158, 66, 91,
	150, 194, 30, 150, 37, 140, 165, 81, 35, 106, 73, 65,
	146, 109, 118, 67, 254, 251, 142, 28, 194, 118, 33, 216,
	96, 240, 124, 111, 222, 227, 205, 137, 249, 160, 113, 111,
	53, 147, 76, 61, 244, 200, 141, 208, 221, 246, 190, 103,
	21, 243, 152, 151, 16, 63, 153, 60, 49, 7, 106, 157, 203,
	30, 37, 55, 82, 104, 217, 109, 229, 10, 129, 214, 17, 83,
	194, 196, 228, 79, 102, 240, 177, 149, 151, 71, 245, 43, 106,
	140, 52, 184, 226, 43, 45, 160, 189, 151, 66, 244, 173, 236,
	232, 189, 9, 253, 170, 152, 195, 116, 40, 174, 3, 228, 182,
	124, 173, 207, 24, 13, 168, 98, 114, 98, 121, 242, 30, 199, 98,
	167, 122, 185, 17, 255, 229, 33, 241, 98, 35, 142, 148, 232, 10,
	112, 41, 218, 47, 192, 249, 124, 190, 24, 236, 191, 110, 189,
	181, 171, 186, 41, 175, 216, 33, 164, 236, 193, 33, 21, 242, 252,
	92, 63, 189, 214, 59, 180, 131, 183, 127, 82, 142, 181, 3, 27, 71,
	155, 114, 221, 10, 210, 31, 32, 234, 5, 34, 150, 212, 254, 24, 3,
	117, 200, 201, 156, 250, 166, 248, 236, 253, 173, 222, 89, 255, 121,
	247, 190, 171, 127, 124, 127, 124, 224, 47, 223, 94, 158, 238, 230,
	45, 35, 139, 176, 120, 140, 69, 165, 130, 207, 160, 50, 209, 203, 178,
	52, 215, 237, 141, 10, 174, 96, 41, 152, 124, 221, 15, 83, 14, 211,
	81, 67, 190, 8, 209, 195, 48, 34, 29, 53, 199, 9, 43, 54, 68, 240,
	138, 58, 101, 41, 151, 255, 69, 108, 32, 101, 125, 3, 157, 49, 38,
	27, 60, 177, 51, 223, 20, 144, 174, 224, 192, 215, 160, 231, 66,
	255, 27, 139, 150, 119, 77, 91, 106, 10, 238, 8, 148, 145, 119, 101,
	173, 141, 238, 154, 105, 128, 84, 90, 250, 24, 167, 224, 235, 121,
	229, 121, 83, 138, 41, 23, 186, 204, 218, 102, 67, 127, 202, 77, 210,
	239, 148, 209, 21, 89, 178, 25, 247, 138, 90, 162, 185, 49, 58, 208,
	248, 47, 107, 31, 162, 144, 166, 2, 0, 0}

func TestUnmarshallingAlfredData(t *testing.T) {
	assert := assert.New(t)

	pushData, err := UnmarshallPushData(alfredDataBytes)
	assert.Nil(err)
	assert.NotNil(pushData)
	assert.Equal(1, len(pushData.Data))
	uncompressData, err := pushData.Data[0].DecompressData()
	assert.NotNil(uncompressData)
	assert.Nil(err)
}
